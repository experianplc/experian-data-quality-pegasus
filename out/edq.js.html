<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: edq.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: edq.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * @module EDQ
 */

(function () {
  /* Configuration */

  /** Used to be granted authorization to make calls to the ProWebOnDemand webservice
   *
   * @name PRO_WEB_AUTH_TOKEN
   * @type {String}
   */

  /** Configuration file that can optionally be used, if configuration is external to this library.
   *  This approach is recommended.
   *
   *  @type {Object}
   */
  EDQ_CONFIG = window.EDQConfig || {};

  PRO_WEB_AUTH_TOKEN = EDQ_CONFIG.PRO_WEB_AUTH_TOKEN || '46832a16-80c0-43d8-af8e-05b3dde5aaaf';

  /** Service endpoint. Do not change unless you have a proxy to use
   *
   * @name PRO_WEB_SERVICE_URL
   * @type {String}
   */
  PRO_WEB_SERVICE_URL = EDQ_CONFIG.PRO_WEB_SERVICE_URL || 'https://ws2.ondemand.qas.com/ProOnDemand/V3/ProOnDemandService.asmx';

  /************************** end Configuration *********************************/

  var root = this;
  var previousEdq = root.EDQ;

  /** Creates a reference to the EDQ object
   *
    * @name EDQ
    * @function
   * @param {Object} object
   * @returns undefined
   */
  var EDQ = function EDQ(object) {
    if (object instanceof EDQ) return object;
    if (!(this instanceof EDQ)) return new EDQ();
    this._wrapped = object;
  };

  if (typeof exports !== 'undefined') {
    if (typeof module !== 'undefined' &amp;&amp; module.exports) {
      exports = module.exports = EDQ;
    }

    exports.EDQ = EDQ;
  } else {
    root.EDQ = EDQ;
  }

  function _proWebHelpers() {
    var _this = this;

    /**
     * @param {String} country
     * @param {Object} engineOptions
     * @param {String} engineType
     * @param {String} layout
     * @param {Function} callback
     *
     * @returns {XMLHttpRequest}
     */
    this.doCanSearch = function (_ref) {
      var country = _ref.country,
          engineOptions = _ref.engineOptions,
          engineType = _ref.engineType,
          layout = _ref.layout,
          callback = _ref.callback;

      var soapActionUrl = 'http://www.qas.com/OnDemand-2011-03/DoCanSearch';
      var xmlRequest = this.buildDoCanSearch.apply(this, arguments);
      return this.makeRequest(xmlRequest, soapActionUrl, callback);
    };

    /*
     * @param {String} layout
     * @param {String} moniker
     * @param {Function} callback
     *
     * @returns {XMLHttpRequest}
     */
    this.doGetAddress = function (_ref2) {
      var layout = _ref2.layout,
          moniker = _ref2.moniker,
          callback = _ref2.callback;

      var soapActionUrl = 'http://www.qas.com/OnDemand-2011-03/DoGetAddress';
      var xmlRequest = this.buildDoGetAddressMessage.apply(this, arguments);
      return this.makeRequest(xmlRequest, soapActionUrl, callback);
    };

    /*
     * @param {Function} callback
     *
     * @returns {XMLHttpRequest}
     */
    this.doGetData = function (_ref3) {
      var callback = _ref3.callback;

      var soapActionUrl = 'http://www.qas.com/OnDemand-2011-03/DoGetData';
      var xmlRequest = this.buildDoGetDataMessage();
      return this.makeRequest(xmlRequest, soapActionUrl, callback);
    };

    /*
     * @param {String} dataMap
     * @param {Function} callback
     *
     * @returns {XMLHttpRequest}
     */
    this.doGetDataMapDetail = function (_ref4) {
      var dataMap = _ref4.dataMap,
          callback = _ref4.callback;

      if (PRO_WEB_SERVICE_URL === 'https://ws2.ondemand.qas.com/ProOnDemand/V3/ProOnDemandService.asmx') {
        throw "This SOAP method is not supported in this version of QAS Pro On Demand";
      }

      var soapActionUrl = 'http://www.qas.com/OnDemand-2011-03/DoGetDataMapDetail';
      var xmlRequest = this.buildDoGetDataMapDetail.apply(this, arguments);
      return this.makeRequest(xmlRequest, soapActionUrl, callback);
    };

    /*
     * @param {String} country
     * @param {String} layout
     * @param {Function} callback
     *
     * @returns {XMLHttpRequest}
     */
    this.doGetExampleAddresses = function (_ref5) {
      var country = _ref5.country,
          layout = _ref5.layout,
          callback = _ref5.callback;

      var soapActionUrl = 'http://www.qas.com/OnDemand-2011-03/DoGetExampleAddresses';
      var xmlRequest = this.buildDoGetExampleAddressesMessage.apply(this, arguments);
      return this.makeRequest(xmlRequest, soapActionUrl, callback);
    };

    /*
     * @param {String} country
     * @param {Function} callback
     *
     * @returns {XMLHttpRequest}
     */
    this.doGetLayouts = function (_ref6) {
      var country = _ref6.country,
          callback = _ref6.callback;

      var soapActionUrl = 'http://www.qas.com/OnDemand-2011-03/DoGetLayouts';
      var xmlRequest = this.buildDoGetLayoutsMessage.apply(this, arguments);
      return this.makeRequest(xmlRequest, soapActionUrl, callback);
    };

    /*
     * @param {Function} callback
     *
     * @returns {XMLHttpRequest}
     */
    this.doGetLicenseInfo = function (_ref7) {
      var callback = _ref7.callback;

      if (PRO_WEB_SERVICE_URL === 'https://ws2.ondemand.qas.com/ProOnDemand/V3/ProOnDemandService.asmx') {
        throw "This SOAP method is not supported in this version of QAS Pro On Demand";
      }

      var soapActionUrl = 'http://www.qas.com/OnDemand-2011-03/DoGetLicenseInfo';
      var xmlRequest = this.buildDoGetLicenseInfoMessage.apply(this, arguments);
      return this.makeRequest(xmlRequest, soapActionUrl, callback);
    };

    /*
     * @param {String} country
     * @param {Object} engineOptions
     * @param {String} engineType
     * @param {String} promptSet
     * @param {Function} callback
     *
     * @returns {XMLHttpRequest}
     */
    this.doGetPromptSet = function (_ref8) {
      var country = _ref8.country,
          engineOptions = _ref8.engineOptions,
          engineType = _ref8.engineType,
          promptSet = _ref8.promptSet,
          callback = _ref8.callback;

      var soapActionUrl = 'http://www.qas.com/OnDemand-2011-03/DoGetPromptSet';
      var xmlRequest = this.buildDoGetPromptSetMessage.apply(this, arguments);
      return this.makeRequest(xmlRequest, soapActionUrl, callback);
    };

    /*
     * @param {Function} callback
     *
     * @returns {XMLHttpRequest}
     */
    this.doGetSystemInfo = function (_ref9) {
      var callback = _ref9.callback;

      var soapActionUrl = 'http://www.qas.com/OnDemand-2011-03/DoGetSystemInfo';
      var xmlRequest = this.buildDoGetSystemInfoMessage();
      this.makeRequest(xmlRequest, soapActionUrl, callback);
    };

    /*
     * @param {String} refineOptions
     * @param {String} moniker
     * @param {String} refinement
     * @param {String} layout
     * @param {Boolean} formattedAddressInPicklist
     * @param {Function} callback
     *
     * @returns {XMLHttpRequest}
     */
    this.doRefine = function (_ref10) {
      var refineOptions = _ref10.refineOptions,
          moniker = _ref10.moniker,
          refinement = _ref10.refinement,
          layout = _ref10.layout,
          formattedAddressInPicklist = _ref10.formattedAddressInPicklist,
          callback = _ref10.callback;

      var soapActionUrl = 'http://www.qas.com/OnDemand-2011-03/DoRefine';
      var xmlRequest = this.buildDoRefineMessage.apply(this, arguments);
      this.makeRequest(xmlRequest, soapActionUrl, callback);
    };

    /*
       * @param {String} country
     * @param {String} engineOptions
     * @param {String} engineType
     * @param {String} layout
     * @param {String} addressQuery
     * @param {Boolean} formattedAddressInPicklist
       * @param {Function} callback
     *
       * @returns {XMLHttpRequest}
     */
    this.doSearch = function (_ref11) {
      var country = _ref11.country,
          engineOptions = _ref11.engineOptions,
          engineType = _ref11.engineType,
          layout = _ref11.layout,
          addressQuery = _ref11.addressQuery,
          formattedAddressInPicklist = _ref11.formattedAddressInPicklist,
          callback = _ref11.callback;

      var soapActionUrl = 'http://www.qas.com/OnDemand-2011-03/DoSearch';
      var xmlRequest = this.buildDoSearchMessage.apply(this, arguments);
      return this.makeRequest(xmlRequest, soapActionUrl, callback);
    };

    /*
       * @param {String} country
     * @param {String} engineOptions
     * @param {String} engineType
     * @param {String} layout
     *
     * @returns {String}
     */
    this.buildDoCanSearch = function (_ref12) {
      var country = _ref12.country,
          engineOptions = _ref12.engineOptions,
          engineType = _ref12.engineType,
          layout = _ref12.layout;

      var xmlString = '&lt;soapenv:Envelope ' + this._buildSoapNamespaceSubString() + '>' + '&lt;soapenv:Body>' + '&lt;ond:QASearch Localisation="" RequestTag="">' + this._buildSoapCountryString(country) + this._buildSoapEngineString({ engineOptions: engineOptions, engineType: engineType }) + this._buildSoapLayoutString(layout) + '&lt;/ond:QASearch>' + '&lt;/soapenv:Body>' + '&lt;/soapenv:Envelope>';

      return xmlString;
    };

    /*
       * @param {String} layout
     * @param {String} moniker
     *
     * @returns {String}
     */
    this.buildDoGetAddressMessage = function (_ref13) {
      var layout = _ref13.layout,
          moniker = _ref13.moniker;

      var xmlString = '&lt;soapenv:Envelope ' + this._buildSoapNamespaceSubString() + '>' + '&lt;soapenv:Body>' + '&lt;ond:QAGetAddress Localisation="" RequestTag="">' + this._buildSoapLayoutString(layout) + '&lt;ond:Moniker>' + moniker + '&lt;/ond:Moniker>' + '&lt;/ond:QAGetAddress>' + '&lt;/soapenv:Body>' + '&lt;/soapenv:Envelope>';

      return xmlString;
    };

    /*
       * @param {String} country
     * @param {String} layout
     *
     * @returns {String}
     */
    this.buildDoGetExampleAddressesMessage = function (_ref14) {
      var country = _ref14.country,
          layout = _ref14.layout;

      var xmlString = '&lt;soapenv:Envelope ' + this._buildSoapNamespaceSubString() + '>' + '&lt;soapenv:Body>' + '&lt;ond:QAGetExampleAddresses Localisation="" RequestTag="">' + this._buildSoapCountryString(country) + this._buildSoapLayoutString(layout) + '&lt;/ond:QAGetExampleAddresses>' + '&lt;/soapenv:Body>' + '&lt;/soapenv:Envelope>';

      return xmlString;
    };

    /*
     * @returns {String}
     */
    this.buildDoGetDataMessage = function () {
      var xmlString = '&lt;soapenv:Envelope ' + this._buildSoapNamespaceSubString() + '>' + '&lt;soapenv:Body>' + '&lt;ond:QAGetData Localisation="" >' + '&lt;/ond:QAGetData>' + '&lt;/soapenv:Body>' + '&lt;/soapenv:Envelope>';

      return xmlString;
    };

    /*
     * @param {String} dataMap
     *
     * @returns {String}
     */
    this.buildDoGetDataMapDetail = function (_ref15) {
      var dataMap = _ref15.dataMap;

      var xmlString = '&lt;soapenv:Envelope ' + this._buildSoapNamespaceSubString() + '>' + '&lt;soapenv:Body>' + '&lt;ond:QAGetDataMapDetail Localisation="">' + this._buildSoapDataMapString(dataMap) + '&lt;/ond:QAGetDataMapDetail>' + '&lt;/soapenv:Body>' + '&lt;/soapenv:Envelope>';

      return xmlString;
    };

    /*
     * @returns {String}
     */
    this.buildDoGetLicenseInfoMessage = function () {
      var xmlString = '&lt;soapenv:Envelope ' + this._buildSoapNamespaceSubString() + '>' + '&lt;soapenv:Body>' + '&lt;ond:QAGetLicenseInfo Localisation=""/>' + '&lt;/soapenv:Body>' + '&lt;/soapenv:Envelope>';

      return xmlString;
    },

    /*
     * @param {String} country
     *
     * @returns {String}
     */
    this.buildDoGetLayoutsMessage = function (_ref16) {
      var country = _ref16.country;

      var xmlString = '&lt;soapenv:Envelope ' + this._buildSoapNamespaceSubString() + '>' + '&lt;soapenv:Body>' + '&lt;ond:QAGetLayouts Localisation="">' + this._buildSoapCountryString(country) + '&lt;/ond:QAGetLayouts>' + '&lt;/soapenv:Body>' + '&lt;/soapenv:Envelope>';

      return xmlString;
    };

    /*
     * @param {String} country
     * @param {Object} engineOptions
     * @param {String} engineType
     * @param {String} promptSet
     *
     * @returns {String}
     */
    this.buildDoGetPromptSetMessage = function (_ref17) {
      var country = _ref17.country,
          engineOptions = _ref17.engineOptions,
          engineType = _ref17.engineType,
          promptSet = _ref17.promptSet;

      var xmlString = '&lt;soapenv:Envelope ' + this._buildSoapNamespaceSubString() + '>' + '&lt;soapenv:Body>' + '&lt;ond:QAGetPromptSet Localisation="">' + this._buildSoapCountryString(country) + this._buildSoapEngineString({ engineOptions: engineOptions, engineType: engineType }) + this._buildSoapPromptSetString(promptSet) + '&lt;/ond:QAGetPromptSet>' + '&lt;/soapenv:Body>' + '&lt;/soapenv:Envelope>';

      return xmlString;
    };

    /*
     * @returns {String}
     */
    this.buildDoGetSystemInfoMessage = function () {
      var xmlString = '&lt;soapenv:Envelope ' + this._buildSoapNamespaceSubString() + '>' + '&lt;soapenv:Body>' + '&lt;ond:QAGetSystemInfo Localisation=""/>' + '&lt;/soapenv:Body>' + '&lt;/soapenv:Envelope>';

      return xmlString;
    };

    /*
     * @param {String} refineOptions
    * @param {String} moniker
    * @param {String} refineOptions
    * @param {String} layout
    * @param {Boolean} formattedAddressInPicklist
    *
    * @returns {String}
    */
    this.buildDoRefineMessage = function (_ref18) {
      var refineOptions = _ref18.refineOptions,
          moniker = _ref18.moniker,
          refinement = _ref18.refinement,
          layout = _ref18.layout,
          formattedAddressInPicklist = _ref18.formattedAddressInPicklist;

      var threshold = this._cleanThreshold(refineOptions.threshold);
      var timeout = this._cleanTimeout(refineOptions.timeout);

      var xmlString = '&lt;soapenv:Envelope ' + this._buildSoapNamespaceSubString() + '>' + '&lt;soapenv:Body>' + '&lt;ond:QARefine Threshold=' + '\"' + threshold + '\"' + ' ' + 'Timeout=' + '\"' + timeout + '\"' + ' ' + 'Localisation=""' + ' ' + 'RequestTag=""' + '>' + this._buildSoapMonikerString(moniker) + this._buildSoapRefinementString(refinement) + this._buildSoapLayoutString(layout) + this._buildSoapFormatString(formattedAddressInPicklist) + '&lt;/ond:QARefine>' + '&lt;/soapenv:Body>' + '&lt;/soapenv:Envelope>';

      return xmlString;
    };

    /*
       * @param {String} country
     * @param {String} engineOptions
     * @param {String} engineType
     * @param {String} layout
     * @param {String} addressQuery
     * @param {Boolean} formattedAddressInPicklist
     *
     * @returns {String}
     */
    this.buildDoSearchMessage = function (_ref19) {
      var country = _ref19.country,
          engineOptions = _ref19.engineOptions,
          engineType = _ref19.engineType,
          layout = _ref19.layout,
          addressQuery = _ref19.addressQuery,
          formattedAddressInPicklist = _ref19.formattedAddressInPicklist;

      var xmlString = '&lt;soapenv:Envelope ' + this._buildSoapNamespaceSubString() + '>' + '&lt;soapenv:Body>' + '&lt;ond:QASearch Localisation="" RequestTag="">' + this._buildSoapCountryString(country) + this._buildSoapEngineString({ engineOptions: engineOptions, engineType: engineType }) + this._buildSoapLayoutString(layout) + this._buildSoapSearchString(addressQuery) + this._buildSoapFormatString(formattedAddressInPicklist) + '&lt;/ond:QASearch>' + '&lt;/soapenv:Body>' + '&lt;/soapenv:Envelope>';

      return xmlString;
    };

    /*
     * @param {String} requestData - a well formed XML string
     * @param {String} soapActionUrl - the SOAP endpoint where the data should be sent
     * @param {Function} callback - a callback that handles success or error.
     *
     * @returns {undefined}
     */
    this.makeRequest = function (requestData, soapActionUrl, callback) {
      var xhr = new XMLHttpRequest();
      var self = _this;

      xhr.withCredentials = false;
      xhr.onreadystatechange = function () {
        if (this.readyState === 4) {

          if (this.status === 200) {
            callback(self._parseDOMChildren(this.responseXML), null);
          } else {
            callback(null, {
              status: 500,
              statusText: 'Internal Server Error',
              responseType: 'text',
              response: 'Due to limitations in cross origin requests (CORS), the error frome the server could not be ' + 'referenced here. For more details about the error, resend this request from a client that is not an internet browser'
            });
          }
        }
      };

      xhr.open('POST', PRO_WEB_SERVICE_URL);
      xhr.setRequestHeader('Auth-Token', PRO_WEB_AUTH_TOKEN);
      xhr.setRequestHeader('SOAPAction', soapActionUrl);
      xhr.setRequestHeader('Content-Type', 'text/xml');
      xhr.send(requestData);
      return xhr;
    };

    /*** Private methods (shouldn't be called from the service directly) ***/

    /*
       * @param {Boolean} flatten
       * @param {String} intensity
       * @param {String} promptSet
       * @param {Number} threshold
       * @param {Number} timeout
       *
     * @returns {Object} - a new object that's similar to 'engineOptions', except there are no
     * undefined values, and instead are replaced with empty strings.
     */

    this._cleanEngineOptions = function (_ref20) {
      var flatten = _ref20.flatten,
          intensity = _ref20.intensity,
          promptSet = _ref20.promptSet,
          threshold = _ref20.threshold,
          timeout = _ref20.timeout;

      return {
        flatten: flatten || true,
        intensity: intensity || 'Close',
        promptSet: promptSet || 'Default',
        threshold: this._cleanThreshold(threshold),
        timeout: this._cleanTimeout(timeout)
      };
    };

    /*
       * @param {Number} threshold
       *
     * @returns {Number}
     */
    this._cleanThreshold = function (threshold) {
      return threshold || 10000;
    };

    /*
       * @param {Number} timeout
       *
     * @returns {Number}
     */
    this._cleanTimeout = function (timeout) {
      return timeout || 10000;
    };

    /*
       * @param {String} formatAddress
       *
     * @returns {String}
     */
    this._buildSoapFormatString = function (formatAddress) {
      return '&lt;ond:FormattedAddressInPicklist>' + formatAddress + '&lt;/ond:FormattedAddressInPicklist>';
    };

    /*
       * @param {Object} object.engineOptions - contains an object that has the engine options (see #_cleanEngineOptions)
     * @param {String} engineType
       *
     * @returns {String}
     */
    this._buildSoapEngineString = function (object) {
      var engineOptions = object.engineOptions;
      var engineType = object.engineType;

      var result = this._cleanEngineOptions(engineOptions);

      var flatten = result.flatten;
      var intensity = result.intensity;
      var promptSet = result.promptSet;
      var threshold = result.threshold;
      var timeout = result.timeout;

      var engineSoapString = '&lt;ond:Engine' + ' ' + 'Flatten=' + '\'' + flatten + '\' ' + 'Intensity=' + '\'' + intensity + '\' ' + 'PromptSet=' + '\'' + promptSet + '\' ' + 'Threshold=' + '\'' + threshold + '\' ' + 'Timeout=' + '\'' + timeout + '\' ' + '>' + engineType + '&lt;/ond:Engine>';

      return engineSoapString;
    };

    /*
       * @returns {String}
       */
    this._buildSoapNamespaceSubString = function () {
      return 'xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" ' + 'xmlns:ond="http://www.qas.com/OnDemand-2011-03"';
    };

    /*
       * @param {String} moniker
       *
     * @returns {String}
     */
    this._buildSoapMonikerString = function (moniker) {
      return '&lt;ond:Moniker>' + moniker + '&lt;/ond:Moniker>';
    },

    /*
       * @param {String} refinement
       *
     * @returns {String}
     */
    this._buildSoapRefinementString = function (refinement) {
      return '&lt;ond:Refinement>' + refinement + '&lt;/ond:Refinement>';
    };

    /*
       * @param {String} layoutType
       *
     * @returns {String}
     */
    this._buildSoapLayoutString = function () {
      var layoutType = arguments.length > 0 &amp;&amp; arguments[0] !== undefined ? arguments[0] : 'AllElements';

      return '&lt;ond:Layout>' + layoutType + '&lt;/ond:Layout>';
    };

    /* @param {String} addressQuery
       *
     * @returns {String}
     */
    this._buildSoapSearchString = function (addressQuery) {
      return '&lt;ond:Search>' + addressQuery + '&lt;/ond:Search>';
    };

    /* @param {String} promptSet
       *
     * @returns {String}
     */
    this._buildSoapPromptSetString = function (promptSet) {
      return '&lt;ond:PromptSet>' + promptSet + '&lt;/ond:PromptSet>';
    };

    /* @param {String} country
       *
     * @returns {String}
     */
    this._buildSoapCountryString = function (country) {
      return '&lt;ond:Country>' + country + '&lt;/ond:Country>';
    };

    /*
     * @param {String} dataMap
     *
     * @returns {String}
     */
    this._buildSoapDataMapString = function (dataMap) {
      return '&lt;ond:DataMap>' + dataMap + '&lt;/ond:DataMap>';
    };

    /*** Taken from X2JS ***/

    this._parseDOMChildren = function (node, path) {
      var config = arguments.length > 2 &amp;&amp; arguments[2] !== undefined ? arguments[2] : {};

      config = initConfigDefaults(config);

      function initConfigDefaults(config) {
        return {
          escapeMode: config.escapeMode || true,
          attributePrefix: config.attributePrefix || "_",
          arrayAccessForm: config.arrayAccessForm || "none",
          emptyNodeForm: config.emptyNodeForm || "text",
          enableToStringFunc: config.enableToStringFunc || true,
          arrayAccessFormPaths: config.arrayAccessFormPaths || [],
          skipEmptyTextNodesForObj: config.skipEmptyTextNodesForObj || true,
          stripWhitespaces: config.stripWhitespaces || true,
          datetimeAccessFormPaths: config.datetimeAccessFormPaths || [],
          useDoubleQuotes: config.useDoubleQuotes || false,
          xmlElementsFilter: config.xmlElementsFilter || [],
          jsonPropertiesFilter: config.jsonPropertiesFilter || [],
          keepCData: config.keepCData || false
        };
      }

      var DOMNodeTypes = {
        ELEMENT_NODE: 1,
        TEXT_NODE: 3,
        CDATA_SECTION_NODE: 4,
        COMMENT_NODE: 8,
        DOCUMENT_NODE: 9
      };

      function getNodeLocalName(node) {
        var nodeLocalName = node.localName;
        if (nodeLocalName == null) // Yeah, this is IE!!
          nodeLocalName = node.baseName;
        if (nodeLocalName == null || nodeLocalName == "") // =="" is IE too
          nodeLocalName = node.nodeName;
        return nodeLocalName;
      }

      function getNodePrefix(node) {
        return node.prefix;
      }

      function escapeXmlChars(str) {
        if (typeof str == "string") return str.replace(/&amp;/g, '&amp;amp;').replace(/&lt;/g, '&amp;lt;').replace(/>/g, '&amp;gt;').replace(/"/g, '&amp;quot;').replace(/'/g, '&amp;apos;');else return str;
      }

      function unescapeXmlChars(str) {
        return str.replace(/&amp;lt;/g, '&lt;').replace(/&amp;gt;/g, '>').replace(/&amp;quot;/g, '"').replace(/&amp;apos;/g, "'").replace(/&amp;amp;/g, '&amp;');
      }

      function checkInStdFiltersArrayForm(stdFiltersArrayForm, obj, name, path) {
        var idx = 0;
        for (; idx &lt; stdFiltersArrayForm.length; idx++) {
          var filterPath = stdFiltersArrayForm[idx];
          if (typeof filterPath === "string") {
            if (filterPath == path) break;
          } else if (filterPath instanceof RegExp) {
            if (filterPath.test(path)) break;
          } else if (typeof filterPath === "function") {
            if (filterPath(obj, name, path)) break;
          }
        }
        return idx != stdFiltersArrayForm.length;
      }

      function toArrayAccessForm(obj, childName, path) {
        switch (config.arrayAccessForm) {
          case "property":
            if (!(obj[childName] instanceof Array)) obj[childName + "_asArray"] = [obj[childName]];else obj[childName + "_asArray"] = obj[childName];
            break;
          /*case "none":
          	break;*/
        }

        if (!(obj[childName] instanceof Array) &amp;&amp; config.arrayAccessFormPaths.length > 0) {
          if (checkInStdFiltersArrayForm(config.arrayAccessFormPaths, obj, childName, path)) {
            obj[childName] = [obj[childName]];
          }
        }
      }

      function fromXmlDateTime(prop) {
        // Implementation based up on http://stackoverflow.com/questions/8178598/xml-datetime-to-javascript-date-object
        // Improved to support full spec and optional parts
        var bits = prop.split(/[-T:+Z]/g);

        var d = new Date(bits[0], bits[1] - 1, bits[2]);
        var secondBits = bits[5].split("\.");
        d.setHours(bits[3], bits[4], secondBits[0]);
        if (secondBits.length > 1) d.setMilliseconds(secondBits[1]);

        // Get supplied time zone offset in minutes
        if (bits[6] &amp;&amp; bits[7]) {
          var offsetMinutes = bits[6] * 60 + Number(bits[7]);
          var sign = /\d\d-\d\d:\d\d$/.test(prop) ? '-' : '+';

          // Apply the sign
          offsetMinutes = 0 + (sign == '-' ? -1 * offsetMinutes : offsetMinutes);

          // Apply offset and local timezone
          d.setMinutes(d.getMinutes() - offsetMinutes - d.getTimezoneOffset());
        } else if (prop.indexOf("Z", prop.length - 1) !== -1) {
          d = new Date(Date.UTC(d.getFullYear(), d.getMonth(), d.getDate(), d.getHours(), d.getMinutes(), d.getSeconds(), d.getMilliseconds()));
        }

        // d is now a local time equivalent to the supplied time
        return d;
      }

      function checkFromXmlDateTimePaths(value, childName, fullPath) {
        if (config.datetimeAccessFormPaths.length > 0) {
          var path = fullPath.split("\.#")[0];
          if (checkInStdFiltersArrayForm(config.datetimeAccessFormPaths, value, childName, path)) {
            return fromXmlDateTime(value);
          } else return value;
        } else return value;
      }

      function checkXmlElementsFilter(obj, childType, childName, childPath) {
        if (childType == DOMNodeTypes.ELEMENT_NODE &amp;&amp; config.xmlElementsFilter.length > 0) {
          return checkInStdFiltersArrayForm(config.xmlElementsFilter, obj, childName, childPath);
        } else return true;
      }

      if (node.nodeType == DOMNodeTypes.DOCUMENT_NODE) {
        var result = new Object();
        var nodeChildren = node.childNodes;
        // Alternative for firstElementChild which is not supported in some environments
        for (var cidx = 0; cidx &lt; nodeChildren.length; cidx++) {
          var child = nodeChildren.item(cidx);
          if (child.nodeType == DOMNodeTypes.ELEMENT_NODE) {
            var childName = getNodeLocalName(child);
            result[childName] = this._parseDOMChildren(child, childName);
          }
        }
        return result;
      } else if (node.nodeType == DOMNodeTypes.ELEMENT_NODE) {
        var result = new Object();
        result.__cnt = 0;

        var nodeChildren = node.childNodes;

        // Children nodes
        for (var cidx = 0; cidx &lt; nodeChildren.length; cidx++) {
          var child = nodeChildren.item(cidx); // nodeChildren[cidx];
          var childName = getNodeLocalName(child);

          if (child.nodeType != DOMNodeTypes.COMMENT_NODE) {
            var childPath = path + "." + childName;
            if (checkXmlElementsFilter(result, child.nodeType, childName, childPath)) {
              result.__cnt++;
              if (result[childName] == null) {
                result[childName] = this._parseDOMChildren(child, childPath);
                toArrayAccessForm(result, childName, childPath);
              } else {
                if (result[childName] != null) {
                  if (!(result[childName] instanceof Array)) {
                    result[childName] = [result[childName]];
                    toArrayAccessForm(result, childName, childPath);
                  }
                }
                result[childName][result[childName].length] = this._parseDOMChildren(child, childPath);
              }
            }
          }
        }

        for (var aidx = 0; aidx &lt; node.attributes.length; aidx++) {
          var attr = node.attributes.item(aidx);
          result.__cnt++;
          result[config.attributePrefix + attr.name] = attr.value;
        }

        var nodePrefix = getNodePrefix(node);
        if (nodePrefix != null &amp;&amp; nodePrefix != "") {
          result.__cnt++;
          result.__prefix = nodePrefix;
        }

        if (result["#text"] != null) {
          result.__text = result["#text"];
          if (result.__text instanceof Array) {
            result.__text = result.__text.join("\n");
          }
          if (config.stripWhitespaces) result.__text = result.__text.trim();
          delete result["#text"];
          if (config.arrayAccessForm == "property") delete result["#text_asArray"];
          result.__text = checkFromXmlDateTimePaths(result.__text, childName, path + "." + childName);
        }
        if (result["#cdata-section"] != null) {
          result.__cdata = result["#cdata-section"];
          delete result["#cdata-section"];
          if (config.arrayAccessForm == "property") delete result["#cdata-section_asArray"];
        }

        if (result.__cnt == 0 &amp;&amp; config.emptyNodeForm == "text") {
          result = '';
        } else if (result.__cnt == 1 &amp;&amp; result.__text != null) {
          result = result.__text;
        } else if (result.__cnt == 1 &amp;&amp; result.__cdata != null &amp;&amp; !config.keepCData) {
          result = result.__cdata;
        } else if (result.__cnt > 1 &amp;&amp; result.__text != null &amp;&amp; config.skipEmptyTextNodesForObj) {
          if (config.stripWhitespaces &amp;&amp; result.__text == "" || result.__text.trim() == "") {
            delete result.__text;
          }
        }
        delete result.__cnt;

        if (config.enableToStringFunc &amp;&amp; (result.__text != null || result.__cdata != null)) {
          result.toString = function () {
            return (this.__text != null ? this.__text : '') + (this.__cdata != null ? this.__cdata : '');
          };
        }

        return result;
      } else if (node.nodeType == DOMNodeTypes.TEXT_NODE || node.nodeType == DOMNodeTypes.CDATA_SECTION_NODE) {
        return node.nodeValue;
      }
    };
  };

  var helper = new _proWebHelpers();

  /**
   * Represents a book.
   * @constructor
   * @param {string} title - The title of the book.
   * @param {string} author - The author of the book.
   */
  function Book(title, author) {}

  EDQ.address = {

    /**
     * This module is a wrapper around the SOAP XML calls for ProWebOnDemand.
     * Additional documentation for the SOAP calls can be found here:
     *
     * &lt;br>&lt;br> {@link https://www.edq.com/documentation/apis/address-validate/address-validate-soap/}
     *
     * @module ProWeb
     */
    proWeb: {

      /**
       * Checks that the combination of data mapping, engine and layout are valid for searching.
       *
       * @name DoCanSearch
       * @function
       *
       * @param {String} country
       * @param {Object} engineOptions
       * @param {String} engineType
       * @param {String} layout
       * @param {Function} callback
       *
       * @returns {XMLHttpRequest}
       */
      doCanSearch: helper.doCanSearch.bind(helper),

      /**
       * Formats a picklist item to obtain a final, formatted address.
       *
       * @name DoGetAddress
       * @function
       *
       * @param {String} layout
       * @param {String} moniker
       * @param {Function} callback
       *
       * @returns {XMLHttpRequest}
       */
      doGetAddress: helper.doGetAddress.bind(helper),

      /**
       * Obtains a list of available data mappings
       *
       * @name DoGetData
       * @function
       *
       * @param {Function} callback
       *
       * @returns {XMLHttpRequest}
       */
      doGetData: helper.doGetData.bind(helper),

      /**
       * NOTE: This does not function on the latest version of ProWeb
       *
       * @name DoGetDataMapDetail
       * @function
       *
       * @param {String} dataMap
       * @param {Function} callback
       *
       * @returns {XMLHttpRequest}
       */
      doGetDataMapDetail: helper.doGetDataMapDetail.bind(helper),

      /**
       * Returns fully formatted example addresses
       *
       * @name DoGetExampleAddresses
       * @function
       *
       * @param {String} country
       * @param {String} layout
       * @param {Function} callback
       *
       * @returns {XMLHttpRequest}
       */
      doGetExampleAddresses: helper.doGetExampleAddresses.bind(helper),

      /**
       * Obtains a list of layouts that have been configured within the configuration file.
       *
       * @name DoGetLayouts
       * @function
       *
       * @param {String} country
       * @param {Function} callback
       *
       * @returns {XMLHttpRequest}
       */
      doGetLayouts: helper.doGetLayouts.bind(helper),

      /**
       * Returns license information for ProWebOnDemand.
       *
       * @name DoGetLicenseInfo
       * @function
       *
       * @param {Function} callback
       *
       * @returns {XMLHttpRequest}
       */
      doGetLicenseInfo: helper.doGetLicenseInfo.bind(helper),

      /**
       * Returns prompt set information.
       *
       * @name DoGetPromptSet
       * @function
       *
       * @param {String} country
       * @param {Object} engineOptions
       * @param {String} engineType
       * @param {String} promptSet
       * @param {Function} callback
       *
       * @returns {XMLHttpRequest}
       */
      doGetPromptSet: helper.doGetPromptSet.bind(helper),

      /**
       * Returns information about the server
       *
       * @name DoGetSystemInfo
       * @function
       *
       * @param {Function} callback
       *
       * @returns {XMLHttpRequest}
       */
      doGetSystemInfo: helper.doGetSystemInfo.bind(helper),

      /**
       * Used to step into and refine a picklist result
       *
       * @name DoRefine
       * @function
       *
       * @param {String} refineOptions
       * @param {String} moniker
       * @param {String} refinement
       * @param {String} layout
       * @param {Boolean} formattedAddressInPicklist
       * @param {Function} callback
       *
       * @returns {XMLHttpRequest}
       */
      doRefine: helper.doRefine.bind(helper),

      /**
       * Submits an initial search to the server
       *
       * @name DoSearch
       * @function
       *
       * @param {String} country
       * @param {String} engineOptions
       * @param {String} engineType
       * @param {String} layout
       * @param {String} addressQuery
       * @param {Boolean} formattedAddressInPicklist
       * @param {Function} callback
       *
       * @returns {XMLHttpRequest}
       */
      doSearch: helper.doSearch.bind(helper)
    }
  };
}).call(this);</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-EDQ.html">EDQ</a></li><li><a href="module-ProWeb.html">ProWeb</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.3</a> on Fri Apr 07 2017 11:13:22 GMT-0700 (PDT)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
